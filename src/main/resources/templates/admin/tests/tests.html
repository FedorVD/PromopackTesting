<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Список тестов</title>
    <link rel="icon" href="/promopack_logo.ico" type="image/x-icon">
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
</head>
<body>

<div th:replace="admin/_fragments :: layout(title='Управление тестами', username=${username}, message=${message}, error=${error})">
</div> <br/>

<div class="container mt-4">
    <h2>Список тестов</h2>

    <form action="#" th:action="@{/admin/tests/tests}" method="get">
        <input type="hidden" name="_csrf" th:value="${_csrf.token}" />

        <div class="form-group">
            <label for="themeFilter">Фильтр по теме:</label>
            <select id="themeFilter" name="themeId" class="form-control mb-3">
                <option value="">-- Все темы --</option>
                <option th:each="theme : ${themes}"
                        th:value="${theme.id}"
                        th:selected="${theme.id == selectedThemeId}"
                        th:text="${theme.themeName}"></option>
            </select>
        </div>

        <div class="form-group">
            <label for="statusFilter">Статус:</label>
            <select id="statusFilter" name="status" class="form-control mb-3">
                <option value="">-- Все статусы --</option>
                <option value="active" th:selected="${selectedStatus == true}">Активные</option>
                <option value="inactive" th:selected="${selectedStatus == false}">Неактивные</option>
            </select>
        </div>

        <div class="form-group">
            <label for="search">Поиск по названию:</label>
            <input type="text" id="search" name="search" class="form-control mb-3"
                   th:value="${search}" placeholder="Введите название..." />
        </div>

        <button type="submit" class="btn btn-primary">Применить фильтр</button>
        <a href="/admin/tests/tests" class="btn btn-secondary">Сбросить</a>
    </form>

    <br />

    <table class="table table-bordered table-striped">
        <thead>
        <tr>
            <th>Тема тестирования</th>
            <th>Название теста</th>
            <th>Создал</th>
            <th>Дата создания</th>
            <th>Статус</th>
            <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${tests.isEmpty()}">
            <td colspan="6" class="text-center">Тесты не найдены.</td>
        </tr>
        <tr th:each="test : ${tests}">
            <td th:text="${test.themeTest?.themeName ?: 'Не задана'}">Тема</td>
            <td th:text="${test.name}">Название теста</td>
            <td th:text="${test.createdBy?.username ?: 'Неизвестно'}">Создатель</td>
            <td th:text="${#temporals.format(test.createdAt, 'dd.MM.yyyy')}">Дата создания</td>
            <td>
                <span th:if="${test.isActive}" class="badge bg-success">Активный</span>
                <span th:unless="${test.isActive}" class="badge bg-danger">Неактивный</span>
            </td>
            <td>
                <a th:href="@{/admin/tests/{id}/viewTest(id=${test.id})}" class="btn btn-sm btn-info">Вопросы</a>
                <a th:href="@{/admin/tests/{id}/edit(id=${test.id})}" class="btn btn-sm btn-secondary">Редактировать</a>
            </td>
        </tr>
        </tbody>
    </table><br />

    <a href="/admin/tests/addTest" class="btn btn-success mt-3">Добавить новый тест</a>
</div>

<br />
<script src="/js/logout.js" defer></script>
</body>
</html>